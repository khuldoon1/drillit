{"ast":null,"code":"import Node, { addNodeClass } from '../core/Node.js';\nimport { bufferAttribute, dynamicBufferAttribute } from './BufferAttributeNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { nodeProxy, vec3, mat3, mat4 } from '../shadernode/ShaderNode.js';\nimport { DynamicDrawUsage } from 'three';\nclass InstanceNode extends Node {\n  constructor(instanceMesh) {\n    super('void');\n    this.instanceMesh = instanceMesh;\n    this.instanceMatrixNode = null;\n  }\n  construct(builder) {\n    let instanceMatrixNode = this.instanceMatrixNode;\n    if (instanceMatrixNode === null) {\n      const instanceMesh = this.instanceMesh;\n      const instaceAttribute = instanceMesh.instanceMatrix;\n      const array = instaceAttribute.array;\n      const bufferFn = instaceAttribute.usage === DynamicDrawUsage ? dynamicBufferAttribute : bufferAttribute;\n      const instanceBuffers = [\n      // F.Signature -> bufferAttribute( array, type, stride, offset )\n      bufferFn(array, 'vec4', 16, 0), bufferFn(array, 'vec4', 16, 4), bufferFn(array, 'vec4', 16, 8), bufferFn(array, 'vec4', 16, 12)];\n      instanceMatrixNode = mat4(...instanceBuffers);\n      this.instanceMatrixNode = instanceMatrixNode;\n    }\n\n    // POSITION\n\n    const instancePosition = instanceMatrixNode.mul(positionLocal).xyz;\n\n    // NORMAL\n\n    const m = mat3(instanceMatrixNode[0].xyz, instanceMatrixNode[1].xyz, instanceMatrixNode[2].xyz);\n    const transformedNormal = normalLocal.div(vec3(m[0].dot(m[0]), m[1].dot(m[1]), m[2].dot(m[2])));\n    const instanceNormal = m.mul(transformedNormal).xyz;\n\n    // ASSIGNS\n\n    builder.stack.assign(positionLocal, instancePosition);\n    builder.stack.assign(normalLocal, instanceNormal);\n    return builder.stack;\n  }\n}\nexport default InstanceNode;\nexport const instance = nodeProxy(InstanceNode);\naddNodeClass(InstanceNode);","map":{"version":3,"names":["Node","addNodeClass","bufferAttribute","dynamicBufferAttribute","normalLocal","positionLocal","nodeProxy","vec3","mat3","mat4","DynamicDrawUsage","InstanceNode","constructor","instanceMesh","instanceMatrixNode","construct","builder","instaceAttribute","instanceMatrix","array","bufferFn","usage","instanceBuffers","instancePosition","mul","xyz","m","transformedNormal","div","dot","instanceNormal","stack","assign","instance"],"sources":["C:/Users/LENOVO/Desktop/reactjsProject/drillit/node_modules/three/examples/jsm/nodes/accessors/InstanceNode.js"],"sourcesContent":["import Node, { addNodeClass } from '../core/Node.js';\r\nimport { bufferAttribute, dynamicBufferAttribute } from './BufferAttributeNode.js';\r\nimport { normalLocal } from './NormalNode.js';\r\nimport { positionLocal } from './PositionNode.js';\r\nimport { nodeProxy, vec3, mat3, mat4 } from '../shadernode/ShaderNode.js';\r\nimport { DynamicDrawUsage } from 'three';\r\n\r\nclass InstanceNode extends Node {\r\n\r\n\tconstructor( instanceMesh ) {\r\n\r\n\t\tsuper( 'void' );\r\n\r\n\t\tthis.instanceMesh = instanceMesh;\r\n\r\n\t\tthis.instanceMatrixNode = null;\r\n\r\n\t}\r\n\r\n\tconstruct( builder ) {\r\n\r\n\t\tlet instanceMatrixNode = this.instanceMatrixNode;\r\n\r\n\t\tif ( instanceMatrixNode === null ) {\r\n\r\n\t\t\tconst instanceMesh = this.instanceMesh;\r\n\t\t\tconst instaceAttribute = instanceMesh.instanceMatrix;\r\n\t\t\tconst array = instaceAttribute.array;\r\n\r\n\t\t\tconst bufferFn = instaceAttribute.usage === DynamicDrawUsage ? dynamicBufferAttribute : bufferAttribute;\r\n\r\n\t\t\tconst instanceBuffers = [\r\n\t\t\t\t// F.Signature -> bufferAttribute( array, type, stride, offset )\r\n\t\t\t\tbufferFn( array, 'vec4', 16, 0 ),\r\n\t\t\t\tbufferFn( array, 'vec4', 16, 4 ),\r\n\t\t\t\tbufferFn( array, 'vec4', 16, 8 ),\r\n\t\t\t\tbufferFn( array, 'vec4', 16, 12 )\r\n\t\t\t];\r\n\r\n\t\t\tinstanceMatrixNode = mat4( ...instanceBuffers );\r\n\r\n\t\t\tthis.instanceMatrixNode = instanceMatrixNode;\r\n\r\n\t\t}\r\n\r\n\t\t// POSITION\r\n\r\n\t\tconst instancePosition = instanceMatrixNode.mul( positionLocal ).xyz;\r\n\r\n\t\t// NORMAL\r\n\r\n\t\tconst m = mat3( instanceMatrixNode[ 0 ].xyz, instanceMatrixNode[ 1 ].xyz, instanceMatrixNode[ 2 ].xyz );\r\n\r\n\t\tconst transformedNormal = normalLocal.div( vec3( m[ 0 ].dot( m[ 0 ] ), m[ 1 ].dot( m[ 1 ] ), m[ 2 ].dot( m[ 2 ] ) ) );\r\n\r\n\t\tconst instanceNormal = m.mul( transformedNormal ).xyz;\r\n\r\n\t\t// ASSIGNS\r\n\r\n\t\tbuilder.stack.assign( positionLocal, instancePosition );\r\n\t\tbuilder.stack.assign( normalLocal, instanceNormal );\r\n\r\n\t\treturn builder.stack;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport default InstanceNode;\r\n\r\nexport const instance = nodeProxy( InstanceNode );\r\n\r\naddNodeClass( InstanceNode );\r\n"],"mappings":"AAAA,OAAOA,IAAI,IAAIC,YAAY,QAAQ,iBAAiB;AACpD,SAASC,eAAe,EAAEC,sBAAsB,QAAQ,0BAA0B;AAClF,SAASC,WAAW,QAAQ,iBAAiB;AAC7C,SAASC,aAAa,QAAQ,mBAAmB;AACjD,SAASC,SAAS,EAAEC,IAAI,EAAEC,IAAI,EAAEC,IAAI,QAAQ,6BAA6B;AACzE,SAASC,gBAAgB,QAAQ,OAAO;AAExC,MAAMC,YAAY,SAASX,IAAI,CAAC;EAE/BY,WAAWA,CAAEC,YAAY,EAAG;IAE3B,KAAK,CAAE,MAAO,CAAC;IAEf,IAAI,CAACA,YAAY,GAAGA,YAAY;IAEhC,IAAI,CAACC,kBAAkB,GAAG,IAAI;EAE/B;EAEAC,SAASA,CAAEC,OAAO,EAAG;IAEpB,IAAIF,kBAAkB,GAAG,IAAI,CAACA,kBAAkB;IAEhD,IAAKA,kBAAkB,KAAK,IAAI,EAAG;MAElC,MAAMD,YAAY,GAAG,IAAI,CAACA,YAAY;MACtC,MAAMI,gBAAgB,GAAGJ,YAAY,CAACK,cAAc;MACpD,MAAMC,KAAK,GAAGF,gBAAgB,CAACE,KAAK;MAEpC,MAAMC,QAAQ,GAAGH,gBAAgB,CAACI,KAAK,KAAKX,gBAAgB,GAAGP,sBAAsB,GAAGD,eAAe;MAEvG,MAAMoB,eAAe,GAAG;MACvB;MACAF,QAAQ,CAAED,KAAK,EAAE,MAAM,EAAE,EAAE,EAAE,CAAE,CAAC,EAChCC,QAAQ,CAAED,KAAK,EAAE,MAAM,EAAE,EAAE,EAAE,CAAE,CAAC,EAChCC,QAAQ,CAAED,KAAK,EAAE,MAAM,EAAE,EAAE,EAAE,CAAE,CAAC,EAChCC,QAAQ,CAAED,KAAK,EAAE,MAAM,EAAE,EAAE,EAAE,EAAG,CAAC,CACjC;MAEDL,kBAAkB,GAAGL,IAAI,CAAE,GAAGa,eAAgB,CAAC;MAE/C,IAAI,CAACR,kBAAkB,GAAGA,kBAAkB;IAE7C;;IAEA;;IAEA,MAAMS,gBAAgB,GAAGT,kBAAkB,CAACU,GAAG,CAAEnB,aAAc,CAAC,CAACoB,GAAG;;IAEpE;;IAEA,MAAMC,CAAC,GAAGlB,IAAI,CAAEM,kBAAkB,CAAE,CAAC,CAAE,CAACW,GAAG,EAAEX,kBAAkB,CAAE,CAAC,CAAE,CAACW,GAAG,EAAEX,kBAAkB,CAAE,CAAC,CAAE,CAACW,GAAI,CAAC;IAEvG,MAAME,iBAAiB,GAAGvB,WAAW,CAACwB,GAAG,CAAErB,IAAI,CAAEmB,CAAC,CAAE,CAAC,CAAE,CAACG,GAAG,CAAEH,CAAC,CAAE,CAAC,CAAG,CAAC,EAAEA,CAAC,CAAE,CAAC,CAAE,CAACG,GAAG,CAAEH,CAAC,CAAE,CAAC,CAAG,CAAC,EAAEA,CAAC,CAAE,CAAC,CAAE,CAACG,GAAG,CAAEH,CAAC,CAAE,CAAC,CAAG,CAAE,CAAE,CAAC;IAErH,MAAMI,cAAc,GAAGJ,CAAC,CAACF,GAAG,CAAEG,iBAAkB,CAAC,CAACF,GAAG;;IAErD;;IAEAT,OAAO,CAACe,KAAK,CAACC,MAAM,CAAE3B,aAAa,EAAEkB,gBAAiB,CAAC;IACvDP,OAAO,CAACe,KAAK,CAACC,MAAM,CAAE5B,WAAW,EAAE0B,cAAe,CAAC;IAEnD,OAAOd,OAAO,CAACe,KAAK;EAErB;AAED;AAEA,eAAepB,YAAY;AAE3B,OAAO,MAAMsB,QAAQ,GAAG3B,SAAS,CAAEK,YAAa,CAAC;AAEjDV,YAAY,CAAEU,YAAa,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}